<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictado M√°gico: El Gran Reto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #f0fdfa 0%, #dcfce7 100%);
            color: #1e293b;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-card {
            background: white;
            border-radius: 40px;
            padding: 2.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 8px solid #34d399;
            max-width: 700px; 
            width: 95%;
            text-align: center;
            position: relative;
        }

        .btn-speaker {
            background-color: #fbbf24;
            border: 6px solid #f59e0b;
            border-radius: 50%;
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 0 #b45309;
            margin: 0 auto 1.5rem;
        }

        .btn-speaker:active {
            transform: translateY(6px);
            box-shadow: 0 4px 0 #b45309;
        }

        .btn-speaker span {
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
        }

        input {
            border: 6px solid #94a3b8;
            border-radius: 25px;
            padding: 1.5rem; 
            outline: none;
            font-weight: 700;
            font-size: 2.2rem; 
            text-align: center;
            width: 100%;
            transition: all 0.3s;
            margin-top: 15px;
            color: #064e3b;
            background-color: #f8fafc;
        }

        .input-correct {
            border-color: #22c55e !important;
            background-color: #f0fdf4 !important;
            color: #15803d !important;
            animation: bounce 0.6s;
        }

        .input-incorrect {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
            color: #b91c1c !important;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-12px); }
            40% { transform: translateX(12px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .progress-bar {
            height: 24px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
            margin-top: 1.5rem;
            border: 3px solid #cbd5e1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            width: 0%;
            transition: width 0.5s ease-out;
        }

        .instruction-badge {
            background-color: #fffbeb;
            border: 4px dashed #fbbf24;
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 25px;
            color: #92400e;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

    <div class="mt-4 mb-6 text-center">
        <h1 class="text-5xl font-black text-emerald-700 mb-2 drop-shadow-sm">üåà El Gran Dictado M√°gico ü¶Ñ</h1>
        <p class="text-xl text-emerald-900 font-bold">¬°Escribe nombres propios y comunes! ‚ú®</p>
    </div>

    <div class="game-card">
        <!-- Adornos visuales -->
        <span class="floating-emoji" style="top: -20px; left: -20px;">üé®</span>
        <span class="floating-emoji" style="top: -20px; right: -20px; animation-delay: 1s;">üß∏</span>
        <span class="floating-emoji" style="bottom: -20px; left: -20px; animation-delay: 2s;">üéà</span>
        <span class="floating-emoji" style="bottom: -20px; right: -20px; animation-delay: 1.5s;">üç≠</span>

        <div class="flex justify-between mb-4 gap-2">
            <span class="bg-emerald-100 text-emerald-700 px-5 py-2 rounded-2xl font-black text-lg border-2 border-emerald-200">üìù Frase: <span id="current-word-num">1</span>/100</span>
            <span class="bg-rose-100 text-rose-700 px-5 py-2 rounded-2xl font-black text-lg border-2 border-rose-200">‚ùå Errores: <span id="error-count">0</span></span>
        </div>

        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>

        <div class="mt-8">
            <div class="instruction-badge">
                <span class="text-3xl">‚≠ê</span> <span>Usa <b>May√∫sculas</b>, <b>punto final</b> y presiona <b>Enter</b></span>
            </div>

            <button class="btn-speaker" onclick="reproducirPalabra()" id="speaker-btn" title="Escuchar frase">
                <span class="text-8xl">üì¢</span>
            </button>
            
            <div id="status-msg" class="h-12 mb-4 font-black text-2xl"></div>
            
            <input type="text" id="word-input" placeholder="Escribe aqu√≠..." autocomplete="off" onkeydown="siEsEnter(event)">
            
            <div class="mt-8">
                <p class="text-slate-500 font-bold text-lg">Paso 1: ¬°Escucha! üëÇ</p>
                <p class="text-slate-500 font-bold text-lg">Paso 2: ¬°Escribe y pulsa Enter! ‚å®Ô∏è</p>
            </div>
        </div>
    </div>

    <div id="final-screen" class="hidden fixed inset-0 bg-emerald-50 z-50 flex flex-col items-center justify-center p-6 text-center">
        <h2 class="text-7xl mb-6 font-black text-emerald-600 animate-bounce">üéä ¬°ERES INCRE√çBLE! üéä</h2>
        <p class="text-4xl mb-10 font-bold text-emerald-800">¬°Terminaste todas las frases m√°gicas!</p>
        <div class="bg-white p-12 rounded-[50px] shadow-2xl border-8 border-emerald-400">
            <p class="text-5xl font-black text-emerald-700">Total de errores: <span id="final-errors">0</span></p>
            <p class="text-2xl mt-4 text-emerald-500 font-bold">¬°Lo hiciste genial! üèÜ</p>
        </div>
        <button onclick="location.reload()" class="mt-12 bg-emerald-500 text-white px-12 py-6 rounded-full text-4xl font-black shadow-[0_12px_0_#059669] active:translate-y-2 active:shadow-none hover:bg-emerald-400 transition-all">¬°Jugar de nuevo! üîÑ</button>
    </div>

    <audio id="sound-success" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <script>
        const baseFrases = [
            // Lista simplificada y mezclada (100 frases)
            "La rana salta", "Hoy vino Luis", "El perro corre", "Busca a Ana", "El gato come", 
            "Llama a Pepe", "La nina juega", "Mira a Marta", "El nino canta", "Canta con Juan",
            "La foca nada", "Viaja a Espana", "El pato vuela", "Visita Mexico", "La mesa brilla", 
            "Mira a Paris", "El lobo aulla", "Roma es vieja", "La vaca muge", "Cruza Chile hoy",
            "El pajaro pia", "Marte es rojo", "La luna sale", "Venus brilla mucho", "El sol quema", 
            "Saturno tiene anillos", "La flor crece", "Jupiter es gigante", "El barco flota", "Pluton esta lejos",
            "La mama rie", "Hola soy Betito", "El papa lee", "Dora busca mapas", "La abuela teje", 
            "Lucas corre rapido", "El coche para", "Mateo escribe bien", "La lluvia cae", "Elena pinta mucho",
            "El oso duerme", "Toby ladra fuerte", "La abeja vuela", "Michi duerme aqui", "El conejo salta", 
            "Pipo vuela alto", "La tortuga camina", "Coco come mucho", "El leon ruge", "Bibi nada bien",
            "La pelota bota", "Madrid es grande", "El tren pita", "Lima tiene sol", "La puerta abre", 
            "Quito tiene nubes", "El gallo canta", "Bogota esta lejos", "La sopa quema", "Tokio tiene luces",
            "La casa limpia", "Sara barre todo", "El viento sopla", "Raul sube alto", "El pez nada", 
            "Ines baja pronto", "La estrella brilla", "Tomas abre cajas", "El fuego arde", "Rosa tiene flores",
            "El rio pasa", "Bruno corre fuera", "La nube viaja", "Luna sale tarde", "El libro ensena", 
            "Sol calienta mucho", "La radio suena", "Nube tapa sol", "El reloj marca", "Viento sopla hoy",
            "La sopa sabe", "Carlos arregla esto", "El bebe llora", "Diana compra fruta", "La llave gira", 
            "Mario gana siempre", "El zapato aprieta", "Lucia busca llaves", "La hormiga carga", "Oscar rompe algo",
            "El tigre caza", "Africa tiene selvas", "La cebra corre", "Asia es inmensa", "El mono trepa", 
            "Europa tiene nieve", "La vaca pasta", "America es grande", "El raton escapa", "Oceania tiene mar"
        ];

        const frases = baseFrases.map(f => f + ".");
        let currentIndex = 0;
        let errors = 0;
        let vozSeleccionada = null;

        // Funci√≥n para normalizar texto (quitar acentos)
        function normalizar(texto) {
            return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function cargarVoces() {
            const voces = window.speechSynthesis.getVoices();
            if (voces.length === 0) return;

            vozSeleccionada = voces.find(v => {
                const nombre = v.name.toLowerCase();
                return v.lang.startsWith('es') && 
                       (nombre.includes('sof√≠a') || nombre.includes('sandra') || 
                        nombre.includes('ni√±a') || nombre.includes('femenina') || 
                        nombre.includes('female'));
            }) || voces.find(v => v.lang === 'es-MX') || voces.find(v => v.lang.startsWith('es'));
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = cargarVoces;
        }

        function reproducirPalabra() {
            window.speechSynthesis.cancel();
            if (!vozSeleccionada) cargarVoces();
            const mensaje = new SpeechSynthesisUtterance(baseFrases[currentIndex]);
            if (vozSeleccionada) mensaje.voice = vozSeleccionada;
            mensaje.lang = 'es-MX';
            mensaje.rate = 0.9;
            mensaje.pitch = 1.2;
            window.speechSynthesis.speak(mensaje);
        }

        function siEsEnter(event) {
            if (event.key === "Enter") {
                validarEscritura();
            }
        }

        function validarEscritura() {
            const input = document.getElementById('word-input');
            const valorEscrito = input.value.trim().replace(/\s+/g, ' '); 
            const fraseCorrecta = frases[currentIndex];

            // Comparamos versiones normalizadas (sin acentos)
            if (normalizar(valorEscrito) === normalizar(fraseCorrecta)) {
                marcarCorrecto();
            } else {
                marcarIncorrecto(valorEscrito);
            }
        }

        function marcarCorrecto() {
            const input = document.getElementById('word-input');
            const statusMsg = document.getElementById('status-msg');
            const successSound = document.getElementById('sound-success');

            input.classList.add('input-correct');
            statusMsg.innerHTML = "<span class='text-green-500'>¬°GENIAL! ‚≠ê‚≠ê‚≠ê</span>";
            try { successSound.play(); } catch(e) {}

            setTimeout(() => {
                currentIndex++;
                if (currentIndex < frases.length) {
                    actualizarUI();
                    setTimeout(() => {
                        reproducirPalabra();
                    }, 600);
                } else {
                    mostrarPantallaFinal();
                }
            }, 1200);
        }

        function marcarIncorrecto(valor) {
            const input = document.getElementById('word-input');
            const statusMsg = document.getElementById('status-msg');
            const fraseCorrecta = frases[currentIndex];
            
            errors++;
            document.getElementById('error-count').innerText = errors;
            input.classList.add('input-incorrect');
            
            if (valor.length === 0) {
                statusMsg.innerHTML = "<span class='text-rose-500'>¬°Escribe algo! ‚úèÔ∏è</span>";
            } else if (!valor.endsWith('.')) {
                statusMsg.innerHTML = "<span class='text-rose-500'>Pon el punto final üìç</span>";
            } else {
                const palabrasEscritas = valor.split(' ');
                const palabrasCorrectas = fraseCorrecta.split(' ');
                let errorMayuscula = false;

                for (let i = 0; i < palabrasCorrectas.length; i++) {
                    if (palabrasEscritas[i]) {
                        // Comprobaci√≥n de may√∫sculas (esta s√≠ se mantiene estricta)
                        if (palabrasCorrectas[i][0] === palabrasCorrectas[i][0].toUpperCase() && 
                            palabrasEscritas[i][0] !== palabrasEscritas[i][0].toUpperCase()) {
                            errorMayuscula = true;
                            break;
                        }
                    }
                }

                if (errorMayuscula) {
                    statusMsg.innerHTML = "<span class='text-rose-500'>Revisa las MAY√öSCULAS üèõÔ∏è</span>";
                } else {
                    statusMsg.innerHTML = "<span class='text-rose-500'>¬°Sigue intentando! üîÑ</span>";
                }
            }

            setTimeout(() => {
                input.classList.remove('input-incorrect');
            }, 1500);
        }

        function actualizarUI() {
            const input = document.getElementById('word-input');
            input.value = "";
            input.classList.remove('input-correct', 'input-incorrect');
            document.getElementById('status-msg').innerHTML = "";
            document.getElementById('current-word-num').innerText = currentIndex + 1;
            const progreso = (currentIndex / frases.length) * 100;
            document.getElementById('progress-fill').style.width = progreso + "%";
            input.focus();
        }

        function mostrarPantallaFinal() {
            document.getElementById('final-errors').innerText = errors;
            document.getElementById('final-screen').classList.remove('hidden');
        }

        window.onload = () => {
            cargarVoces();
            actualizarUI();
        };
    </script>
</body>
</html>
