<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Superhero Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #bae6fd 0%, #ede9fe 100%);
            color: #1e293b;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            position: relative;
        }

        /* Figuras de fondo: Relojes */
        .shape-bg {
            position: fixed;
            z-index: -1;
            opacity: 0.25;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));
            pointer-events: none;
            animation: floatShape 15s infinite ease-in-out;
        }

        @keyframes floatShape {
            0% { transform: translateY(0) rotate(0deg) scale(1); }
            50% { transform: translateY(-40px) rotate(10deg) scale(1.1); }
            100% { transform: translateY(0) rotate(0deg) scale(1); }
        }

        .game-card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(8px);
            border-radius: 40px;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 8px solid #0ea5e9;
            max-width: 800px; 
            width: 95%;
            text-align: center;
            position: relative;
            cursor: pointer;
            max-height: 75vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .text-container {
            font-size: 2.2rem;
            line-height: 2.2; 
            text-align: left;
            margin: 1.5rem 0;
            color: #0f172a; 
            font-weight: 700;
        }

        .word {
            display: inline-block;
            margin-right: 12px;
            transition: color 0.2s;
        }

        .status-badge {
            background-color: #f59e0b;
            color: white;
            padding: 12px 35px;
            border-radius: 25px;
            font-weight: 800;
            margin-bottom: 0.5rem;
            display: inline-block;
            box-shadow: 0 6px 0 #b45309;
            border: 3px solid #fff;
        }

        .reading-active {
            background-color: #10b981;
            box-shadow: 0 6px 0 #065f46;
        }

        .game-card::-webkit-scrollbar {
            display: none;
        }

        /* Estilo para el reloj digital SVG */
        .digital-clock-text {
            font-family: monospace;
            font-weight: bold;
            font-size: 25px;
        }
    </style>
</head>
<body onclick="handleGlobalClick(event)">

    <!-- Relojes Anal√≥gicos de Fondo -->
    <svg class="shape-bg" style="top: 10%; left: 5%; width: 140px;" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#0ea5e9" stroke-width="6" />
        <line x1="50" y1="50" x2="50" y2="25" stroke="#0ea5e9" stroke-width="5" stroke-linecap="round" />
        <line x1="50" y1="50" x2="70" y2="50" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round" />
        <circle cx="50" cy="50" r="3" fill="#0ea5e9" />
    </svg>

    <svg class="shape-bg" style="top: 65%; left: 80%; width: 160px; animation-delay: -5s;" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#818cf8" stroke-width="8" />
        <line x1="50" y1="50" x2="35" y2="35" stroke="#818cf8" stroke-width="6" stroke-linecap="round" />
        <line x1="50" y1="50" x2="50" y2="15" stroke="#818cf8" stroke-width="4" stroke-linecap="round" />
    </svg>

    <!-- Relojes Digitales de Fondo -->
    <svg class="shape-bg" style="top: 75%; left: 15%; width: 180px; animation-delay: -2s;" viewBox="0 0 200 100">
        <rect x="10" y="20" width="180" height="60" rx="10" fill="#f472b6" />
        <text x="50%" y="62%" dominant-baseline="middle" text-anchor="middle" fill="white" class="digital-clock-text">12:00</text>
    </svg>

    <svg class="shape-bg" style="top: 20%; left: 75%; width: 150px; animation-delay: -8s;" viewBox="0 0 200 100">
        <rect x="10" y="20" width="180" height="60" rx="10" fill="#fbbf24" />
        <text x="50%" y="62%" dominant-baseline="middle" text-anchor="middle" fill="white" class="digital-clock-text">03:45</text>
    </svg>

    <svg class="shape-bg" style="top: 45%; left: -2%; width: 120px; animation-delay: -12s;" viewBox="0 0 200 100">
        <rect x="10" y="20" width="180" height="60" rx="10" fill="#2dd4bf" />
        <text x="50%" y="62%" dominant-baseline="middle" text-anchor="middle" fill="white" class="digital-clock-text">09:15</text>
    </svg>

    <div class="mt-4 mb-4 text-center">
        <h1 class="text-5xl font-black text-sky-800 mb-1 drop-shadow-sm">ü¶∏‚Äç‚ôÇÔ∏è Math Superhero Reader ü¶∏‚Äç‚ôÄÔ∏è</h1>
        <p class="text-xl text-sky-900 font-bold">Touch to Play/Pause! üöÄ</p>
    </div>

    <div class="game-card" id="main-card">
        <div class="flex justify-between items-center mb-4 sticky top-0 bg-white/95 z-20 py-2 rounded-2xl px-4">
            <span class="bg-sky-500 text-white px-6 py-2 rounded-2xl font-black text-xl shadow-md">
                üìñ Read: <span id="read-count">0</span>
            </span>
            <div id="play-status" class="status-badge text-xl">
                <span id="status-icon">‚ñ∂Ô∏è</span> <span id="status-text">Tap to Start</span>
            </div>
        </div>

        <div id="paragraph" class="text-container">
            <!-- Words injected here -->
        </div>

        <div class="mt-4 text-sky-400 font-bold italic pb-6">
            Fixed Safari Sync ‚Ä¢ Telling Time Edition ‚è∞
        </div>
    </div>

    <!-- Modal de repetici√≥n -->
    <div id="repeat-modal" class="hidden fixed inset-0 bg-sky-900/60 backdrop-blur-md z-50 flex items-center justify-center p-6" onclick="event.stopPropagation()">
        <div class="bg-white p-10 rounded-[50px] shadow-2xl border-8 border-sky-400 text-center max-w-sm">
            <h2 class="text-4xl font-black text-sky-600 mb-3">Amazing! üéä</h2>
            <p class="text-2xl font-bold text-slate-600 mb-8">You are a Time Hero!</p>
            <button onclick="resetAndRead(event)" class="bg-emerald-500 text-white px-10 py-4 rounded-full text-2xl font-black shadow-[0_8px_0_#065f46] active:translate-y-1 transition-all">Play Again üîÑ</button>
        </div>
    </div>

    <script>
        const originalText = "In my math class, I learned how to tell time using an analog clock. I know that the short hand points to the hour and the long hand shows the minutes. When the big hand is at the top, we say it is \"o'clock.\" It is exciting to know exactly when it is time for lunch or recess! Now I can read the clock all by myself and I am never late for my favorite activities.";
        
        const wordsArray = originalText.split(" ");
        const paragraphContainer = document.getElementById('paragraph');
        const mainCard = document.getElementById('main-card');
        
        let currentWordIndex = 0; 
        let isPlaying = false;
        let readCount = 0;
        let synth = window.speechSynthesis;
        let voices = [];
        let currentUtterance = null;
        let lastConfirmedIndex = 0;

        const wordRanges = [];
        let charAcc = 0;

        wordsArray.forEach((word, index) => {
            const span = document.createElement('span');
            span.classList.add('word');
            span.id = `word-${index}`;
            span.innerText = word;
            paragraphContainer.appendChild(span);

            wordRanges.push({
                start: charAcc,
                end: charAcc + word.length,
                index: index
            });
            charAcc += word.length + 1; 
        });

        function loadVoices() {
            voices = synth.getVoices();
        }
        
        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        function handleGlobalClick(e) {
            if (!document.getElementById('repeat-modal').classList.contains('hidden')) return;
            toggleSpeech();
        }

        function toggleSpeech() {
            if (isPlaying) {
                pauseReading();
            } else {
                resumeOrStart();
            }
        }

        function resumeOrStart() {
            if (currentWordIndex >= wordsArray.length) {
                currentWordIndex = 0;
                lastConfirmedIndex = 0;
            }

            isPlaying = true;
            updateStatusUI(true);

            const startChar = wordRanges[currentWordIndex].start;
            const textToSpeak = originalText.substring(startChar);
            
            currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
            currentUtterance.lang = 'en-US';
            currentUtterance.rate = 0.55; 
            currentUtterance.pitch = 1.1; 

            const preferredVoices = voices.filter(v => v.lang.includes('en-US'));
            const girlVoice = preferredVoices.find(v => 
                v.name.includes('Samantha') || 
                v.name.includes('Nicky') || 
                v.name.includes('Victoria') ||
                v.name.includes('Apple')
            ) || preferredVoices[0];
            
            if (girlVoice) currentUtterance.voice = girlVoice;

            currentUtterance.onboundary = (event) => {
                if (event.name === 'word') {
                    const absoluteCharIndex = startChar + event.charIndex;
                    const wordMatch = wordRanges.find(r => absoluteCharIndex >= r.start && absoluteCharIndex < r.end + 1);
                    
                    if (wordMatch) {
                        if (wordMatch.index >= lastConfirmedIndex) {
                            lastConfirmedIndex = wordMatch.index;
                            currentWordIndex = wordMatch.index;
                            autoScroll(wordMatch.index);
                        }
                    }
                }
            };

            currentUtterance.onend = () => {
                if (isPlaying) {
                    currentWordIndex = wordsArray.length;
                    finishReading();
                }
            };

            synth.cancel();
            setTimeout(() => {
                if (isPlaying) synth.speak(currentUtterance);
            }, 50);
        }

        function pauseReading() {
            isPlaying = false;
            synth.cancel(); 
            currentWordIndex = lastConfirmedIndex + 1;
            updateStatusUI(false);
        }

        function updateStatusUI(playing) {
            const icon = document.getElementById('status-icon');
            const textEl = document.getElementById('status-text');
            const badge = document.getElementById('play-status');
            
            if (playing) {
                icon.innerText = "‚è∏Ô∏è";
                textEl.innerText = "Reading...";
                badge.classList.add('reading-active');
            } else {
                icon.innerText = "‚ñ∂Ô∏è";
                textEl.innerText = "Paused";
                badge.classList.remove('reading-active');
            }
        }

        function autoScroll(index) {
            const wordSpan = document.getElementById(`word-${index}`);
            if (wordSpan) {
                const cardRect = mainCard.getBoundingClientRect();
                const wordRect = wordSpan.getBoundingClientRect();
                const relativeTop = wordRect.top - cardRect.top + mainCard.scrollTop;
                
                mainCard.scrollTo({
                    top: relativeTop - (mainCard.clientHeight / 2),
                    behavior: 'auto'
                });
            }
        }

        function finishReading() {
            isPlaying = false;
            readCount++;
            document.getElementById('read-count').innerText = readCount;
            updateStatusUI(false);
            
            setTimeout(() => {
                document.getElementById('repeat-modal').classList.remove('hidden');
            }, 500);
        }

        function resetAndRead(event) {
            if(event) event.stopPropagation();
            document.getElementById('repeat-modal').classList.add('hidden');
            currentWordIndex = 0;
            lastConfirmedIndex = 0;
            resumeOrStart();
            mainCard.scrollTo({ top: 0 });
        }

        window.onload = loadVoices;
    </script>
</body>
</html>
