<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificador Táctil para iPad</title>
    
    <style>
        body {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif; 
            background-color: #f0f8ff; 
            padding: 20px;
        }

        #contenedor-palabras {
            background-color: #ffffff;
            border: 4px solid #ffcc00; 
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            min-height: 100px; 
        }

        /* Área de toque grande (al menos 44px) */
        .palabra-draggable {
            display: inline-block;
            padding: 12px 20px; /* Tamaño generoso para el dedo */
            margin: 8px; 
            border: 2px solid #6c5ce7; 
            border-radius: 10px;
            background-color: #f7f7f7; 
            color: #333;
            font-size: 22px; 
            cursor: grab;
            user-select: none; 
            transition: background-color 0.3s, transform 0.2s, opacity 0.2s; 
            /* CRÍTICO: Deshabilita el comportamiento de scroll/zoom en el elemento arrastrado */
            touch-action: none; 
        }

        .contenedor-cajas {
            display: flex;
            gap: 20px;
            justify-content: space-around;
            flex-wrap: wrap; 
        }

        .caja-destino {
            flex: 1;
            min-width: 280px; 
            border: 3px dashed #10c660; 
            padding: 20px;
            min-height: 150px;
            background-color: #e6ffe6; 
            border-radius: 15px;
        }

        /* Pop-up de Feedback */
        #feedback-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            border-radius: 10px;
            color: white;
            font-size: 28px;
            z-index: 2000;
            opacity: 0; 
            transition: opacity 0.3s;
        }
        .popup-green { background-color: #28a745; }
        .popup-red { background-color: #dc3545; }

        /* Media Query para tabletas (modo landscape o pantallas grandes) */
        @media (min-width: 768px) {
            .caja-destino {
                min-width: 300px;
            }
        }
    </style>
</head>
<body>

    <div id="contenedor-palabras">
        <h3>Arrastra cada palabra a su categoría:</h3>
    </div>

    <div class="contenedor-cajas">
        <div id="caja-propios" class="caja-destino" data-tipo="propios" 
             ondrop="drop(event)" ondragover="allowDrop(event)">
            <h4>Sustantivos Propios</h4>
        </div>

        <div id="caja-comunes" class="caja-destino" data-tipo="comunes" 
             ondrop="drop(event)" ondragover="allowDrop(event)">
            <h4>Sustantivos Comunes</h4>
        </div>

        <div id="caja-no-sustantivos" class="caja-destino" data-tipo="noSustantivos" 
             ondrop="drop(event)" ondragover="allowDrop(event)">
            <h4>No Sustantivos</h4>
        </div>
    </div>

    <script>
        // Sus palabras
        const palabras = {
            propios: ["Lauren", "Dilan", "Mexico", "Texas", "McDonalds", "FoodTown"],
            comunes: ["libro", "mesa", "camisa", "silla", "rana", "pato"],
            noSustantivos: ["salta", "poco", "come", "grande", "risa", "La"]
        };
        
        let elementoArrastrado = null; 
        let popup = null; 
        
        // --- Pop-up Functions ---
        function crearPopup() {
            popup = document.createElement('div');
            popup.id = 'feedback-popup';
            document.body.appendChild(popup);
        }
        function mostrarPopup(tipo, mensaje) {
            if (!popup) crearPopup(); 
            popup.textContent = mensaje;
            popup.className = ''; 
            popup.classList.add('popup-' + tipo);
            popup.style.opacity = '1';
            setTimeout(() => { popup.style.opacity = '0'; }, 1000);
        }

        // --- Core Drag Logic ---
        function drag(ev) { /* ... (Mouse logic remains) ... */ }
        function allowDrop(ev) { ev.preventDefault(); }
        
        function manejarDrop(draggedElement, destinoCaja) {
            const destinoTipo = destinoCaja.getAttribute('data-tipo');
            const palabraTipo = draggedElement.getAttribute('data-tipo');
            const contenedorInicial = document.getElementById('contenedor-palabras');
            
            // Restablecer estilos
            draggedElement.style.transform = 'scale(1.0)';
            draggedElement.style.opacity = '1.0';
            draggedElement.style.position = 'static'; 
            
            if (palabraTipo === destinoTipo) {
                // Correcto: "pato" === "comunes" (Si la asignación inicial es correcta)
                destinoCaja.appendChild(draggedElement);
                draggedElement.style.backgroundColor = '#a8e6cf'; 
                draggedElement.style.color = '#0e4a1a'; 
                mostrarPopup('green', '¡Correcto!'); 
            } else {
                // Incorrecto
                contenedorInicial.appendChild(draggedElement); 
                draggedElement.style.backgroundColor = '#f7f7f7'; 
                draggedElement.style.color = '#333';
                mostrarPopup('red', '¡Error!'); 
            }
        }

        function drop(ev) { /* ... (Mouse drop logic remains) ... */ }

        // --- Touch Logic (iPad) ---
        function touchstart(ev) { 
            const target = ev.target;
            if (!target.classList.contains('palabra-draggable')) return;
            ev.preventDefault(); // CRÍTICO: Previene el scroll
            elementoArrastrado = target;
            elementoArrastrado.style.position = 'absolute';
            elementoArrastrado.style.zIndex = '1000';
            elementoArrastrado.style.backgroundColor = '#ff6961'; 
            elementoArrastrado.style.transform = 'scale(1.1)'; 
            elementoArrastrado.style.opacity = '0.8';

            const touch = ev.touches[0];
            elementoArrastrado.style.left = touch.pageX - elementoArrastrado.offsetWidth / 2 + 'px';
            elementoArrastrado.style.top = touch.pageY - elementoArrastrado.offsetHeight / 2 + 'px';
        }

        function touchmove(ev) { 
            if (!elementoArrastrado) return;
            ev.preventDefault(); 
            const touch = ev.touches[0];
            elementoArrastrado.style.left = touch.pageX - elementoArrastrado.offsetWidth / 2 + 'px';
            elementoArrastrado.style.top = touch.pageY - elementoArrastrado.offsetHeight / 2 + 'px';
        }

        function touchend(ev) { 
            if (!elementoArrastrado) return;
            ev.preventDefault();
            const touch = ev.changedTouches[0];
            const destino = document.elementFromPoint(touch.clientX, touch.clientY);
            let destinoCaja = destino;
            while (destinoCaja && !destinoCaja.classList.contains('caja-destino')) {
                destinoCaja = destinoCaja.parentElement;
            }

            if (destinoCaja && destinoCaja.classList.contains('caja-destino')) {
                manejarDrop(elementoArrastrado, destinoCaja);
            } else {
                const contenedorInicial = document.getElementById('contenedor-palabras');
                contenedorInicial.appendChild(elementoArrastrado);
                mostrarPopup('red', '¡Error!');
                elementoArrastrado.style.transform = 'scale(1.0)';
                elementoArrastrado.style.opacity = '1.0';
                elementoArrastrado.style.position = 'static'; 
                elementoArrastrado.style.backgroundColor = '#f7f7f7'; 
            }
            elementoArrastrado = null; 
        }

        function prepararEventosTactiles() {
            const palabrasDraggable = document.querySelectorAll('.palabra-draggable');
            palabrasDraggable.forEach(palabra => {
                // { passive: false } es CRÍTICO para prevenir el comportamiento nativo de scroll
                palabra.addEventListener('touchstart', touchstart, { passive: false });
                palabra.addEventListener('touchmove', touchmove, { passive: false });
                palabra.addEventListener('touchend', touchend, { passive: false });
            });
        }

        // --- Inicialización (Corregida para Asignación Segura) ---
        function iniciarJuego() {
            const contenedorPalabras = document.getElementById('contenedor-palabras');
            let todasLasPalabras = [];
            
            // Paso 1: Crear la lista total y asignar el tipo
            for (const tipo in palabras) {
                palabras[tipo].forEach(palabra => {
                    todasLasPalabras.push({ texto: palabra, tipo: tipo });
                });
            }
            
            todasLasPalabras.sort(() => Math.random() - 0.5);
            
            // Paso 2: Crear elementos con data-tipo correcto
            todasLasPalabras.forEach((palabraObj, index) => {
                const p = document.createElement('p');
                p.textContent = palabraObj.texto;
                p.id = `palabra-${index}`;
                p.className = 'palabra-draggable';
                p.draggable = true;
                // ASIGNACIÓN FINAL: Asegura que 'pato' tenga data-tipo="comunes"
                p.setAttribute('data-tipo', palabraObj.tipo); 
                p.setAttribute('ondragstart', 'drag(event)');
                contenedorPalabras.appendChild(p);
            });
            
            prepararEventosTactiles();
            crearPopup();
        }

        window.onload = iniciarJuego;
    </script>
</body>
</html>
