<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pr√°ctica de S√≠labas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --color-primary: #5c6bc0;
            --color-secondary: #42a5f5;
            --color-success: #66bb6a;
            --color-error: #ef5350;
            --color-neutral: #e8eaf6;
            --color-text: #263238;
            --color-background: #f0f2f5;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--color-background);
            margin: 0;
            display: flex;
            justify-content: center; 
            align-items: center;     
            min-height: 100vh;
            color: var(--color-text);
            touch-action: manipulation;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            max-width: 95%;
            width: 650px;
            text-align: center;
            box-sizing: border-box;
        }

        header h1 { color: var(--color-primary); margin-bottom: 10px; font-size: 1.8em; }

        #counter-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        #counter-box, #error-box, #timer-box {
            padding: 10px 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9em;
        }

        #counter-box { background-color: var(--color-neutral); }
        #error-box { background-color: #ffccbc; }
        #timer-box { background-color: #d1ecf1; color: #0c5460; min-width: 100px; }

        #play-syllable-btn {
            background-color: var(--color-secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            font-size: 3.5em;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
            margin-top: 10px;
        }

        #play-syllable-btn:active { transform: scale(0.95); }
        #play-syllable-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .instruction { margin: 15px 0; color: #78909c; font-size: 1.1em; font-weight: bold; }

        .syllable-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }

        .syllable-options input[type="radio"] { display: none; }

        .syllable-options label {
            width: 95px;
            height: 95px;
            background-color: #f7f7f7;
            border: 4px solid #cfd8dc;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2em;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--color-text);
        }

        .syllable-options label.disabled { pointer-events: none; opacity: 0.5; }

        input:checked + label.correct { border-color: var(--color-success); background-color: #e8f5e9; transform: scale(1.05); }
        input:checked + label.incorrect { border-color: var(--color-error); background-color: #ffebee; }

        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 85%;
        }

        .modal-success p { color: var(--color-success); font-size: 2em; font-weight: bold; }
        .modal-error p { color: var(--color-error); font-size: 2em; font-weight: bold; }

        #modal-action-btn {
            margin-top: 25px;
            padding: 15px 45px;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-success #modal-action-btn { background-color: var(--color-success); }
        .modal-error #modal-action-btn { background-color: var(--color-error); }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Pr√°ctica de S√≠labas üó£Ô∏è</h1>
            <div id="counter-group">
                <div id="counter-box">Aciertos: <span id="completed-count">0 de 0</span></div>
                <div id="error-box">Errores: <span id="error-count">0</span></div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div id="timer-box"><i class="fas fa-clock"></i> Tiempo: <span id="timer-display">00:00</span></div>
            </div>
        </header>

        <main>
            <button id="play-syllable-btn"><i class="fas fa-volume-up"></i></button>
            <p class="instruction" id="main-instruction">Toca la bocina para escuchar</p>
            <form id="syllable-options" class="syllable-options"></form>
        </main>
    </div>

    <div id="main-modal" class="modal hidden">
        <div class="modal-content" id="modal-container">
            <p id="modal-message"></p>
            <button id="modal-action-btn">Entendido</button>
        </div>
    </div>

    <script>
        const allSyllables = [
            "ma", "am", "me", "em", "mi", "im", "mo", "om", "mu", "um",
            "pa", "ap", "pe", "ep", "pi", "ip", "po", "op", "pu", "up",
            "sa", "as", "se", "es", "si", "is", "so", "os", "su", "us",
            "la", "al", "le", "el", "li", "il", "lo", "ol", "lu", "ul",
            "ta", "at", "te", "et", "ti", "it", "to", "ot", "tu", "ut",
            "da", "ad", "de", "ed", "di", "id", "do", "od", "du", "ud",
            "ba", "be", "bi", "bo", "bu", "na", "an", "ne", "en", "ni", "in", "no", "on", "nu", "un",
            "va", "ve", "vi", "vo", "vu", "fa", "af", "fe", "ef", "fi", "if", "fo", "of", "fu", "uf"
        ];

        let currentCorrectSyllable = '';
        let completedCount = 0;
        let errorCount = 0;
        let totalAttempts = 0;
        let preferredVoice = null;
        let isInitialized = false;
        let startTime = Date.now();
        
        let timerInterval;
        let secondsElapsed = 0;
        let timerStarted = false;

        const optionsArea = document.getElementById('syllable-options');
        const playButton = document.getElementById('play-syllable-btn');
        const countDisplay = document.getElementById('completed-count');
        const errorCountDisplay = document.getElementById('error-count');
        const timerDisplay = document.getElementById('timer-display');
        const mainModal = document.getElementById('main-modal');
        const modalContainer = document.getElementById('modal-container');
        const modalMessage = document.getElementById('modal-message');
        const modalActionButton = document.getElementById('modal-action-btn');

        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            timerInterval = setInterval(() => {
                secondsElapsed++;
                const mins = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
                const secs = (secondsElapsed % 60).toString().padStart(2, '0');
                timerDisplay.textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function setPreferredVoice() {
            const voices = speechSynthesis.getVoices();
            const targetVoiceNames = [/sandra/i, /sof√≠a/i, /ximena/i, /carmen/i, /teresa/i, /paulina/i, /ni√±a/i, /mujer/i, /female/i];
            const spanishVoices = voices.filter(voice => voice.lang.startsWith('es'));
            let clearVoice = spanishVoices.find(voice => targetVoiceNames.some(regex => regex.test(voice.name)));
            if (!clearVoice) clearVoice = spanishVoices.find(voice => voice.lang === 'es-MX');
            preferredVoice = clearVoice || spanishVoices[0] || null;
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = setPreferredVoice;
        }
        setPreferredVoice();

        function speakSyllable(syllable) {
            if (!syllable) return;
            if (speechSynthesis.speaking) speechSynthesis.cancel();

            // REPARACI√ìN FON√âTICA DEFINITIVA:
            // 1. Usamos min√∫sculas.
            // 2. Envolvemos la s√≠laba con comas y espacios: ", " + syl + ", ". 
            // Esto le dice al iPad: "Esto no es una abreviatura, es una palabra aislada".
            // 3. Para la "o", bajamos un poco el pitch justo en esa s√≠laba para que suene m√°s abierta.
            
            const cleanSyl = syllable.toLowerCase();
            const textToSpeak = ` , ${cleanSyl} , `; 
            
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            
            // Ajuste de tono din√°mico para evitar que la 'o' suene como 'u'
            utterance.pitch = cleanSyl.includes('o') ? 1.0 : 1.2;
            utterance.rate = 0.7; // Un poco m√°s lento para que la uni√≥n de las dos letras sea clara
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
                utterance.lang = preferredVoice.lang;
            } else {
                utterance.lang = 'es-MX';
            }

            utterance.onstart = () => enableOptions();
            utterance.onend = () => playButton.disabled = false;
            speechSynthesis.speak(utterance);
        }

        function generateNewPractice() {
            const shuffled = [...allSyllables].sort(() => 0.5 - Math.random());
            currentCorrectSyllable = shuffled[0];
            const options = shuffled.slice(0, 5).sort(() => 0.5 - Math.random());

            optionsArea.innerHTML = '';
            options.forEach((syl, i) => {
                const radio = document.createElement('input');
                radio.type = 'radio'; radio.name = 'syl'; radio.id = 's' + i; radio.value = syl;
                const label = document.createElement('label');
                label.htmlFor = 's' + i; label.textContent = syl;
                label.classList.add('disabled');
                optionsArea.appendChild(radio);
                optionsArea.appendChild(label);
            });
        }

        function handleSelection(e) {
            if (!isInitialized || (Date.now() - startTime < 1000)) return;

            const selected = e.target.value;
            const label = document.querySelector(`label[for="${e.target.id}"]`);
            disableOptions();
            totalAttempts++;

            if (selected === currentCorrectSyllable) {
                label.classList.add('correct');
                completedCount++;
                showModal(true);
            } else {
                label.classList.add('incorrect');
                errorCount++;
                const correctRadio = document.querySelector(`input[value="${currentCorrectSyllable}"]`);
                document.querySelector(`label[for="${correctRadio.id}"]`).classList.add('correct');
                showModal(false);
            }
            countDisplay.textContent = `${completedCount} de ${totalAttempts}`;
            errorCountDisplay.textContent = errorCount;
        }

        function showModal(isCorrect) {
            mainModal.classList.remove('hidden');
            modalContainer.className = 'modal-content ' + (isCorrect ? 'modal-success' : 'modal-error');
            modalMessage.textContent = isCorrect ? "¬°Muy bien! üåü" : "¬°Casi! Int√©ntalo de nuevo üîç";
            modalActionButton.textContent = isCorrect ? "Siguiente" : "Volver a intentar";
        }

        function enableOptions() {
            document.querySelectorAll('label').forEach(l => l.classList.remove('disabled'));
            optionsArea.addEventListener('change', handleSelection);
        }

        function disableOptions() {
            document.querySelectorAll('label').forEach(l => l.classList.add('disabled'));
            optionsArea.removeEventListener('change', handleSelection);
        }

        playButton.addEventListener('click', () => {
            if (!isInitialized) {
                isInitialized = true;
                generateNewPractice();
                startTimer();
            }
            playButton.disabled = true;
            speakSyllable(currentCorrectSyllable);
        });

        modalActionButton.addEventListener('click', () => {
            mainModal.classList.add('hidden');
            if (modalContainer.classList.contains('modal-success')) {
                generateNewPractice();
                setTimeout(() => {
                    playButton.disabled = true;
                    speakSyllable(currentCorrectSyllable);
                }, 300);
            } else {
                optionsArea.reset();
                document.querySelectorAll('label').forEach(l => l.classList.remove('incorrect', 'correct'));
                enableOptions();
            }
        });

        window.onload = () => {
            countDisplay.textContent = `0 de 0`;
            startTime = Date.now();
        };
    </script>
</body>
</html>
