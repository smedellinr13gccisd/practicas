<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fracciones Divertidas - L√≠neas Naranjas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #fff7ed; 
            margin: 0;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        .math-card {
            width: 100%;
            max-width: 650px;
            background: white;
            border-radius: 32px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            border: 4px solid #fed7aa;
            overflow: hidden;
        }

        .fraction-display {
            background: #ffffff;
            border-radius: 24px;
            padding: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px;
            border: 3px solid #ffedd5;
        }

        .num-btn {
            background: white;
            border: 3px solid #f97316;
            border-radius: 20px;
            padding: 12px;
            font-size: 1.5rem;
            font-weight: 900;
            transition: all 0.2s;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #c2410c;
        }

        .fraction-line {
            width: 30px;
            height: 4px;
            background: #f97316;
            margin: 4px 0;
        }

        .num-btn:active { transform: scale(0.95); }
        .num-btn.correct { background: #dcfce7; border-color: #22c55e; color: #166534; }
        .num-btn.correct .fraction-line { background: #166534; }
        .num-btn.wrong { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .num-btn.wrong .fraction-line { background: #991b1b; }

        .stat-badge {
            background: rgba(0,0,0,0.2);
            padding: 6px 16px;
            border-radius: 12px;
            font-weight: 800;
            color: white;
        }

        #playInstruction {
            transition: transform 0.1s;
        }
        #playInstruction:active { transform: scale(0.9); }
    </style>
</head>
<body>

    <div class="math-card">
        <div class="bg-orange-500 p-5 flex justify-between items-center text-white">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ü¶ä</span>
                <h1 class="text-xl font-black uppercase">Fracciones Claras</h1>
            </div>
            <div class="flex gap-3">
                <div class="stat-badge" id="progress">1 / 22</div>
                <div class="stat-badge bg-orange-700">‚≠ê <span id="score">0</span></div>
            </div>
        </div>

        <div id="game-container">
            <div class="p-6 text-center">
                <button id="playInstruction" class="mb-4 bg-orange-600 text-white p-4 rounded-full shadow-lg hover:bg-orange-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold text-slate-700 mb-6">¬øQu√© fracci√≥n ves?</h2>
                <div class="fraction-display" id="fractionArea"></div>
            </div>

            <div id="options" class="grid grid-cols-2 gap-4 px-6 pb-6"></div>

            <div class="px-6 pb-8 text-center">
                <button id="nextBtn" class="hidden w-full bg-orange-600 text-white py-5 rounded-2xl font-black text-xl shadow-xl hover:bg-orange-700 transition-colors">
                    SIGUIENTE ‚ûî
                </button>
            </div>
        </div>

        <div id="finish-screen" class="hidden p-12 text-center">
            <div class="text-7xl mb-4">‚ú®</div>
            <h2 class="text-4xl font-black text-slate-800 mb-2">¬°Genial!</h2>
            <div class="text-6xl font-black text-orange-600 mb-8" id="finalScore">0 / 22</div>
            <button onclick="location.reload()" class="bg-orange-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-orange-700">JUGAR DE NUEVO</button>
        </div>
    </div>

    <script>
        let currentIdx = 0;
        let score = 0;
        let canAnswer = true;
        let correctNum = 0;
        let correctDen = 0;
        const totalQuestions = 22;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-MX';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function playSound(type) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'success') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            } else {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            }
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }

        function generateProblem() {
            canAnswer = true;
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('progress').innerText = `${currentIdx + 1} / ${totalQuestions}`;

            // M√°ximo sextos (2 a 6)
            correctDen = Math.floor(Math.random() * 5) + 2; 
            correctNum = Math.floor(Math.random() * (correctDen - 1)) + 1;

            const area = document.getElementById('fractionArea');
            area.innerHTML = '';

            const shapes = ['circle', 'rectangle', 'square'];
            const selectedShape = shapes[Math.floor(Math.random() * shapes.length)];

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "240");
            svg.setAttribute("height", "240");
            svg.setAttribute("viewBox", "0 0 100 100");

            // L√≠neas Naranjas y Gruesas
            const strokeColor = "#f97316"; 
            const strokeWidth = "3"; // M√°s gruesas

            if (selectedShape === 'circle') {
                const radius = 45, cx = 50, cy = 50;
                const bgCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                bgCircle.setAttribute("cx", cx); bgCircle.setAttribute("cy", cy); bgCircle.setAttribute("r", radius);
                bgCircle.setAttribute("fill", "#fffaf5"); bgCircle.setAttribute("stroke", strokeColor); bgCircle.setAttribute("stroke-width", strokeWidth);
                svg.appendChild(bgCircle);

                for (let i = 0; i < correctDen; i++) {
                    const startAngle = (i * 360) / correctDen - 90;
                    const endAngle = ((i + 1) * 360) / correctDen - 90;
                    const isColoured = i < correctNum;
                    
                    const x1 = cx + radius * Math.cos((startAngle * Math.PI) / 180);
                    const y1 = cy + radius * Math.sin((startAngle * Math.PI) / 180);
                    const x2 = cx + radius * Math.cos((endAngle * Math.PI) / 180);
                    const y2 = cy + radius * Math.sin((endAngle * Math.PI) / 180);

                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    const d = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`;
                    path.setAttribute("d", d);
                    path.setAttribute("fill", isColoured ? "#fbbf24" : "transparent");
                    path.setAttribute("stroke", strokeColor);
                    path.setAttribute("stroke-width", strokeWidth);
                    svg.appendChild(path);
                }
            } else {
                const width = selectedShape === 'square' ? 80 : 90;
                const height = selectedShape === 'square' ? 80 : 50;
                const startX = (100 - width) / 2;
                const startY = (100 - height) / 2;
                const step = width / correctDen;

                for (let i = 0; i < correctDen; i++) {
                    const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    rect.setAttribute("x", startX + (i * step));
                    rect.setAttribute("y", startY);
                    rect.setAttribute("width", step);
                    rect.setAttribute("height", height);
                    rect.setAttribute("fill", i < correctNum ? "#fbbf24" : "#fffaf5");
                    rect.setAttribute("stroke", strokeColor);
                    rect.setAttribute("stroke-width", strokeWidth);
                    svg.appendChild(rect);
                }
            }

            area.appendChild(svg);

            // Opciones (siempre limitadas al rango del juego)
            let options = [{n: correctNum, d: correctDen}];
            while (options.length < 4) {
                let fD = Math.floor(Math.random() * 5) + 2;
                let fN = Math.floor(Math.random() * (fD - 1)) + 1;
                if (!options.some(o => o.n === fN && o.d === fD)) options.push({n: fN, d: fD});
            }
            options.sort(() => 0.5 - Math.random());

            const optsDiv = document.getElementById('options');
            optsDiv.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'num-btn';
                btn.innerHTML = `<span>${opt.n}</span><div class="fraction-line"></div><span>${opt.d}</span>`;
                btn.onclick = () => checkAnswer(opt, btn);
                optsDiv.appendChild(btn);
            });
        }

        function checkAnswer(val, btn) {
            if (!canAnswer) return;
            canAnswer = false;

            if (val.n === correctNum && val.d === correctDen) {
                btn.classList.add('correct');
                score++;
                document.getElementById('score').innerText = score;
                playSound('success');
                speak("¬°Excelente!");
            } else {
                btn.classList.add('wrong');
                playSound('error');
                speak(`Esa es ${val.n} de ${val.d}. La correcta es ${correctNum} de ${correctDen}`);
                Array.from(document.getElementsByClassName('num-btn')).forEach(b => {
                    const parts = b.innerText.trim().split(/\n/);
                    if (b.innerText.includes(correctNum) && b.innerText.includes(correctDen)) {
                         // Simple check for the correct one visually
                         if (b.children[0].innerText == correctNum && b.children[2].innerText == correctDen)
                            b.classList.add('correct');
                    }
                });
            }
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        document.getElementById('playInstruction').onclick = () => speak("¬øQu√© fracci√≥n est√° coloreada en el dibujo?");
        
        document.getElementById('nextBtn').onclick = () => {
            currentIdx++;
            if (currentIdx < totalQuestions) {
                generateProblem();
            } else {
                document.getElementById('game-container').classList.add('hidden');
                document.getElementById('finish-screen').classList.remove('hidden');
                document.getElementById('finalScore').innerText = `${score} / ${totalQuestions}`;
            }
        };

        window.onload = generateProblem;
    </script>
</body>
</html>
