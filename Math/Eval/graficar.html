<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mi Primera Gr√°fica: 22 Niveles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Optimizaci√≥n para iPad y Touch */
        body {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
        }

        .animal-box {
            background-color: #f0f9ff;
            border: 4px solid #0ea5e9;
            border-radius: 20px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 110px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .animal-item {
            font-size: 2.8rem;
            user-select: none;
        }

        /* √Årea de la gr√°fica */
        .graph-wrapper {
            position: relative;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .graph-main-area {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            width: 300px;
            height: 320px; /* 8 niveles x 40px */
            border-bottom: 6px solid #334155; /* L√≠nea de tierra (Eje X) */
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 100% 40px;
            position: relative;
        }

        .bar-column {
            width: 70px;
            height: 100%;
            display: flex;
            flex-direction: column-reverse;
            cursor: pointer;
            z-index: 10;
        }

        .bar-fill {
            width: 100%;
            border-radius: 4px 4px 0 0;
            transition: height 0.2s ease-out;
        }

        /* Colores vivos para las barras */
        .bar-0 { background-color: #f87171; border: 2px solid #ef4444; border-bottom: none; }
        .bar-1 { background-color: #fbbf24; border: 2px solid #f59e0b; border-bottom: none; }
        .bar-2 { background-color: #60a5fa; border: 2px solid #3b82f6; border-bottom: none; }

        /* Etiquetas DEBAJO de la l√≠nea de tierra */
        .labels-row {
            display: flex;
            justify-content: space-around;
            width: 300px;
            padding-top: 10px;
        }

        .label-item {
            width: 70px;
            text-align: center;
            font-size: 3rem;
            user-select: none;
        }

        .y-axis {
            position: absolute;
            left: -45px;
            height: 320px;
            display: flex;
            flex-direction: column-reverse;
            justify-content: space-between;
            align-items: flex-end;
            width: 30px;
            pointer-events: none;
        }

        .y-number {
            height: 40px;
            display: flex;
            align-items: center;
            font-weight: 900;
            color: #64748b;
            font-size: 1.2rem;
        }

        .card {
            background: white;
            border-radius: 28px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        /* Popup */
        #status-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            width: 85%;
            max-width: 350px;
            text-align: center;
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .btn-action {
            width: 100%;
            padding: 20px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.5rem;
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .btn-action:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="p-4">

    <!-- Popup -->
    <div id="status-popup">
        <div id="popup-icon" class="text-7xl mb-4"></div>
        <h3 id="popup-title" class="text-3xl font-black mb-2"></h3>
        <p id="popup-msg" class="text-lg font-bold mb-6"></p>
        <button onclick="closePopup()" id="popup-btn" class="btn-action text-white"></button>
    </div>

    <div class="max-w-md mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl border-2 border-slate-200">
            <div>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Nivel</p>
                <p class="text-2xl font-black text-slate-700"><span id="level-display">1</span>/22</p>
            </div>
            <div class="text-right">
                <p class="text-[10px] font-bold text-red-400 uppercase tracking-widest">Errores</p>
                <p id="error-display" class="text-2xl font-black text-red-500">0</p>
            </div>
        </header>

        <!-- Animales -->
        <section class="card mb-6">
            <h2 class="text-xs font-black text-slate-400 uppercase text-center mb-3">1. Cuenta los animales</h2>
            <div id="animal-display" class="animal-box"></div>
        </section>

        <!-- Gr√°fica -->
        <section class="card">
            <h2 class="text-xs font-black text-slate-400 uppercase text-center mb-6">2. Dibuja la gr√°fica</h2>
            
            <div class="graph-wrapper">
                <!-- Eje Y -->
                <div class="y-axis">
                    <div class="y-number">1</div><div class="y-number">2</div>
                    <div class="y-number">3</div><div class="y-number">4</div>
                    <div class="y-number">5</div><div class="y-number">6</div>
                    <div class="y-number">7</div><div class="y-number">8</div>
                </div>

                <!-- √Årea de dibujo -->
                <div id="graph-container" class="graph-main-area">
                    <!-- Columnas din√°micas -->
                </div>

                <!-- Etiquetas Emojis (FUERA DE LA GR√ÅFICA) -->
                <div id="labels-container" class="labels-row">
                    <!-- Emojis din√°micos -->
                </div>
            </div>
        </section>

        <!-- Controles -->
        <div class="mt-8 space-y-4">
            <button id="btn-verify" onclick="verifyGraph()" class="btn-action bg-indigo-600 text-white">
                ‚úÖ REVISAR
            </button>
            <button id="btn-next" onclick="nextLevel()" class="btn-action bg-emerald-500 text-white hidden">
                ¬°SIGUIENTE! ‚û°Ô∏è
            </button>
        </div>
    </div>

    <script>
        const emojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'ü¶Å', 'üêØ', 'üê∏', 'üêµ', 'üê£', 'üêô'];
        let categories = [];
        let currentLevel = 1;
        let totalErrors = 0;
        let userCounts = [0, 0, 0];

        function initLevel() {
            const shuffled = [...emojis].sort(() => 0.5 - Math.random());
            categories = shuffled.slice(0, 3).map((emoji, index) => ({
                id: index, emoji: emoji, count: 0
            }));

            userCounts = [0, 0, 0];
            const display = document.getElementById('animal-display');
            display.innerHTML = '';

            let total = 0;
            categories.forEach((cat, idx) => {
                const max = Math.min(8, 14 - total - (2 - idx));
                cat.count = Math.floor(Math.random() * max) + 1;
                total += cat.count;
            });

            const list = [];
            categories.forEach(cat => {
                for(let i=0; i<cat.count; i++) list.push(cat.emoji);
            });
            list.sort(() => 0.5 - Math.random());
            list.forEach(e => {
                const s = document.createElement('span');
                s.className = 'animal-item';
                s.innerText = e;
                display.appendChild(s);
            });

            renderUI();
            document.getElementById('level-display').innerText = currentLevel;
            document.getElementById('btn-verify').classList.remove('hidden');
            document.getElementById('btn-next').classList.add('hidden');
        }

        function renderUI() {
            const gContainer = document.getElementById('graph-container');
            const lContainer = document.getElementById('labels-container');
            gContainer.innerHTML = '';
            lContainer.innerHTML = '';

            categories.forEach((cat, idx) => {
                // Columna de la barra
                const col = document.createElement('div');
                col.className = 'bar-column';
                
                const fill = document.createElement('div');
                fill.id = `fill-${idx}`;
                fill.className = `bar-fill bar-${idx}`;
                fill.style.height = '0%';
                
                col.appendChild(fill);
                
                // Evento de clic/toque
                const handleInput = (e) => {
                    e.preventDefault();
                    if(!document.getElementById('btn-next').classList.contains('hidden')) return;
                    
                    const rect = col.getBoundingClientRect();
                    const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                    const val = 8 - Math.floor(y / 40);
                    
                    userCounts[idx] = (userCounts[idx] === val) ? val - 1 : val;
                    if(userCounts[idx] < 0) userCounts[idx] = 0;
                    if(userCounts[idx] > 8) userCounts[idx] = 8;
                    
                    fill.style.height = (userCounts[idx] * 12.5) + '%';
                };

                col.addEventListener('mousedown', handleInput);
                col.addEventListener('touchstart', handleInput);
                gContainer.appendChild(col);

                // Etiqueta externa
                const label = document.createElement('div');
                label.className = 'label-item';
                label.innerText = cat.emoji;
                lContainer.appendChild(label);
            });
        }

        function verifyGraph() {
            let correct = true;
            categories.forEach((cat, i) => { if(userCounts[i] !== cat.count) correct = false; });

            const p = document.getElementById('status-popup');
            const icon = document.getElementById('popup-icon');
            const title = document.getElementById('popup-title');
            const msg = document.getElementById('popup-msg');
            const btn = document.getElementById('popup-btn');

            if(correct) {
                p.style.backgroundColor = '#f0fdf4';
                p.style.color = '#166534';
                icon.innerText = 'ü§©';
                title.innerText = '¬°PERFECTO!';
                msg.innerText = 'Has contado muy bien los animales.';
                btn.innerText = 'Continuar';
                btn.className = 'btn-action bg-emerald-500 text-white';
                document.getElementById('btn-verify').classList.add('hidden');
                document.getElementById('btn-next').classList.remove('hidden');
            } else {
                totalErrors++;
                document.getElementById('error-display').innerText = totalErrors;
                p.style.backgroundColor = '#fef2f2';
                p.style.color = '#991b1b';
                icon.innerText = '‚ùå';
                title.innerText = '¬°HAY UN ERROR!';
                msg.innerText = 'Vuelve a contar los animales arriba.';
                btn.innerText = 'Intentar de nuevo';
                btn.className = 'btn-action bg-red-600 text-white';
            }
            p.style.display = 'block';
        }

        function closePopup() {
            document.getElementById('status-popup').style.display = 'none';
        }

        function nextLevel() {
            if(currentLevel < 22) { currentLevel++; initLevel(); } 
            else { alert("¬°Felicidades! Completaste todo."); }
        }

        window.onload = initLevel;
    </script>
</body>
</html>
