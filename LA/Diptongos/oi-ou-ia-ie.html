<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clasificaci贸n de Diptongos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.min.js"></script>
  <style>
    /* Estilos generales para el juego */
    body { font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif; background-color: #e0f2fe; /* Azul muy claro */ }
   
    /* Estilo para las palabras que se pueden arrastrar */
    .word-chip {
      cursor: grab;
      user-select: none;
      transition: transform 0.2s, opacity 0.2s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
   
    /* Estilo para las cajas de destino (Drop Zones) */
    .drop-zone {
      min-height: 100px;
      border: 3px dashed #9ca3af; /* Gris sutil */
      transition: background-color 0.2s, transform 0.1s;
    }

    /* Estilo al arrastrar sobre una zona */
    .drop-zone.drag-over {
      border-color: #22c55e; /* Borde verde brillante */
      background-color: #f0fdf4; /* Fondo verde muy claro */
      transform: scale(1.02);
    }

    /* Estilo para las palabras colocadas correctamente */
    .word-chip.placed {
      cursor: default;
      opacity: 0.9;
    }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Nuevos colores para los diptongos oi, ou, ia, ie
            'diptongo-oi': '#a3e635', /* Lima */
            'diptongo-ou': '#34d399', /* Verde menta */
            'diptongo-ia': '#f97316', /* Naranja */
            'diptongo-ie': '#8b5cf6', /* P煤rpura */
            'sin-diptongo': '#fca5a5', /* Rojo suave */
          }
        }
      }
    }
  </script>
</head>
<body class="p-4 sm:p-8">

  <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl p-6 md:p-10 border-b-8 border-purple-500">
   
    <h1 class="text-3xl font-extrabold text-purple-700 text-center mb-4">
      隆El juego de los Diptongos! 
    </h1>
    <p class="text-center text-gray-600 mb-6">
      Arrastra cada palabra a la caja con el Diptongo correcto.
    </p>

        <div id="status-box" class="text-center mb-6 p-3 rounded-xl font-bold bg-yellow-100 text-yellow-800 border-2 border-yellow-400 hidden">
      隆Int茅ntalo de nuevo!
    </div>

        <div id="word-pool" class="bg-blue-200 p-6 rounded-2xl shadow-inner mb-8 min-h-[150px] flex flex-wrap gap-3 justify-center items-center">
            <p id="loading-message" class="text-blue-800 text-lg">Cargando palabras...</p>
    </div>
   
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
     
            <div id="oi" class="drop-zone p-3 rounded-xl text-center bg-diptongo-oi/30 shadow-md" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
        <p class="font-bold text-lg text-green-800">Diptongo: OI</p>
      </div>
     
            <div id="ou" class="drop-zone p-3 rounded-xl text-center bg-diptongo-ou/30 shadow-md" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
        <p class="font-bold text-lg text-green-900">Diptongo: OU</p>
      </div>
     
            <div id="ia" class="drop-zone p-3 rounded-xl text-center bg-diptongo-ia/30 shadow-md" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
        <p class="font-bold text-lg text-orange-800">Diptongo: IA</p>
      </div>
     
            <div id="ie" class="drop-zone p-3 rounded-xl text-center bg-diptongo-ie/30 shadow-md" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
        <p class="font-bold text-lg text-purple-800">Diptongo: IE</p>
      </div>

            <div id="none" class="drop-zone p-3 rounded-xl text-center bg-sin-diptongo/30 shadow-md col-span-2 md:col-span-1" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
        <p class="font-bold text-lg text-red-700">Sin Diptongo</p>
      </div>
    </div>

        <div class="text-center mt-8">
      <button onclick="resetGame()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 focus:outline-none focus:ring-4 focus:ring-pink-300">
        Reiniciar Juego
      </button>
    </div>

  </div>

  <script>
    const WORD_DATA = [
      // Diptongos OI
      { word: "b**oi**na", type: "oi", color: "diptongo-oi" },
      { word: "h**oi**zo", type: "oi", color: "diptongo-oi" },
      { word: "parano**i**a", type: "oi", color: "diptongo-oi" },
     
      // Diptongos OU (Muy poco com煤n en palabras de uso frecuente, usamos los ejemplos conocidos)
      { word: "estad**ou**nidense", type: "ou", color: "diptongo-ou" },
      { word: "s**ou**venir", type: "ou", color: "diptongo-ou" },
      { word: "l**ou**nge", type: "ou", color: "diptongo-ou" },

      // Diptongos IA
      { word: "p**ia**no", type: "ia", color: "diptongo-ia" },
      { word: "d**ia**rio", type: "ia", color: "diptongo-ia" },
      { word: "grac**ia**s", type: "ia", color: "diptongo-ia" },
      { word: "famil**ia**", type: "ia", color: "diptongo-ia" },

      // Diptongos IE
      { word: "m**ie**do", type: "ie", color: "diptongo-ie" },
      { word: "c**ie**lo", type: "ie", color: "diptongo-ie" },
      { word: "v**ie**nto", type: "ie", color: "diptongo-ie" },
      { word: "p**ie**l", type: "ie", color: "diptongo-ie" },

      // Sin Diptongo (Palabras sencillas)
      { word: "mesa", type: "none", color: "sin-diptongo" },
      { word: "pato", type: "none", color: "sin-diptongo" },
      { word: "silla", type: "none", color: "sin-diptongo" },
      { word: "leche", type: "none", color: "sin-diptongo" },
    ];

    const wordPool = document.getElementById('word-pool');
    const statusBox = document.getElementById('status-box');
    let placedCount = 0;
    const totalWords = WORD_DATA.length;

        // =================================================================
        // *** VARIABLES Y LGICA TCTIL (Touch) - AGREGADAS/MODIFICADAS ***
        // =================================================================
        
        // Variables globales para la funcionalidad t谩ctil (iPad/M贸vil)
        let activeWord = null;
        let currentDropZone = null;
        let initialX = 0;
        let initialY = 0;

        function handleTouchStart(e) {
            // 1. Iniciar el arrastre
            if (e.target.classList.contains('word-chip') && !e.target.classList.contains('placed')) {
                activeWord = e.target;
                e.preventDefault(); // Impedir el scroll de la p谩gina
                
                // Almacenar la posici贸n inicial del toque
                initialX = e.touches[0].clientX;
                initialY = e.touches[0].clientY;
                
                // Preparar el elemento para el arrastre visual
                activeWord.style.position = 'absolute';
                activeWord.style.zIndex = 1000;
            }
        }

        function handleTouchMove(e) {
            // 2. Mover el elemento
            if (activeWord) {
                e.preventDefault();
                
                // Calcular nuevo offset basado en el movimiento del dedo
                const xOffset = e.touches[0].clientX - initialX;
                const yOffset = e.touches[0].clientY - initialY;

                // Aplicar la transformaci贸n de movimiento
                activeWord.style.transform = `translate(${xOffset}px, ${yOffset}px) scale(1.1)`;

                // --- Simular dragOver ---
                const touch = e.touches[0];
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);

                const newDropZone = elementBelow ? elementBelow.closest('.drop-zone') : null;

                if (currentDropZone && currentDropZone !== newDropZone) {
                    currentDropZone.classList.remove('drag-over');
                }

                if (newDropZone) {
                    newDropZone.classList.add('drag-over');
                    currentDropZone = newDropZone;
                } else {
                    currentDropZone = null;
                }
            }
        }

        function handleTouchEnd(e) {
            // 3. Soltar el elemento
            if (activeWord) {
                const wordToDrop = activeWord;
                
                // Limpiar estilos del elemento arrastrado
                wordToDrop.style.position = 'static';
                wordToDrop.style.zIndex = 'auto';
                wordToDrop.style.transform = ''; // Importante: se usa la clase 'placed'
                
                // Limpiar estilos del contenedor
                if (currentDropZone) {
                    currentDropZone.classList.remove('drag-over');
                }

                if (currentDropZone) {
                    // Simular el evento 'drop'
                    const correctType = wordToDrop.getAttribute('data-type');
                    
                    if (currentDropZone.id === correctType) {
                        dropLogic(wordToDrop, currentDropZone); 
                    } else {
                        errorLogic(wordToDrop);
                    }
                } else {
                    // Regresar al pool si no se solt贸 en una zona v谩lida
                    wordPool.appendChild(wordToDrop);
                }

                // Restablecer variables
                activeWord = null;
                currentDropZone = null;
            }
        }


    // *** CONFIGURACIN DE SONIDO CON TONE.JS ***
   
    // Ajustamos el volumen general para que sea m谩s bajo
    Tone.Master.volume.value = -12; // Baja el volumen a -12 dB

    // 1. Sintetizador de 茅xito (Cash Register/Chime)
    const successSynth = new Tone.MembraneSynth({
      pitchDecay: 0.05,
      octaves: 8,
      envelope: {
        attack: 0.001,
        decay: 0.4,
        sustain: 0.01,
        release: 0.01
      }
    }).toDestination();

    function playSuccessSound() {
      // Toca tres notas r谩pidas y ascendentes: C5, E5, G5
      successSynth.triggerAttackRelease("C5", "16n");
      successSynth.triggerAttackRelease("E5", "16n", "+0.05");
      successSynth.triggerAttackRelease("G5", "16n", "+0.1");
    }

    // 2. Sintetizador de error (Oh Oh/Incorrecto)
    const errorSynth = new Tone.Synth({
      oscillator: { type: "square" },
      envelope: {
        attack: 0.05,
        decay: 0.3,
        sustain: 0.1,
        release: 0.2
      }
    }).toDestination();

    function playErrorSound() {
      // Toca dos notas bajas y cercanas (C3 y B2) para el efecto "Oh Oh"
      errorSynth.triggerAttackRelease("C3", "8n");
      errorSynth.triggerAttackRelease("B2", "8n", "+0.15");
    }
   
    // *** LGICA DEL JUEGO ***

    // Mezcla el array de palabras para que salgan en orden aleatorio
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Genera los chips de palabras en la caja grande
        // MODIFICADA para asignar eventos t谩ctiles
    function generateWordChips() {
      wordPool.innerHTML = ''; // Limpiar el mensaje de carga
      shuffleArray(WORD_DATA);

      WORD_DATA.forEach((data, index) => {
        const chip = document.createElement('div');
        chip.id = `word-${index}`;
        chip.className = `word-chip bg-${data.color} p-3 rounded-full font-bold text-lg text-gray-800 shadow-md hover:scale-105 transition`;
        chip.setAttribute('draggable', true);
        chip.setAttribute('data-type', data.type);
        chip.innerHTML = data.word.replace(/\*\*/g, ''); // Mostrar la palabra sin negritas

        // ASIGNACIN DE EVENTOS PARA ESCRITORIO (Mouse)
        chip.addEventListener('dragstart', drag);
                
                // ASIGNACIN DE EVENTOS PARA MVIL (Touch) <-- ESTO ES LO NUEVO
                chip.addEventListener('touchstart', handleTouchStart);
                
        wordPool.appendChild(chip);
      });
            
            // Asignar los listeners de movimiento y fin al documento entero para mejor captura
            // Esto permite que el arrastre siga funcionando aunque el dedo se salga del elemento
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
    }

    // *** Funciones Drag and Drop (Mouse) ***
   
    function allowDrop(ev) {
      ev.preventDefault();
      // Agregar el estilo de 'drag-over' al entrar
      ev.currentTarget.classList.add('drag-over');
    }
   
    function dragLeave(ev) {
      // Quitar el estilo de 'drag-over' al salir
      ev.currentTarget.classList.remove('drag-over');
    }

    function drag(ev) {
      // Guarda el ID del chip que se est谩 arrastrando
      ev.dataTransfer.setData("text/plain", ev.target.id);
      // Guarda el tipo de diptongo correcto
      ev.dataTransfer.setData("type", ev.target.getAttribute('data-type'));
    }
        
        // Funci贸n auxiliar para la L贸gica de ACIERTO
        function dropLogic(droppedWord, targetZone) {
            playSuccessSound();
            statusBox.textContent = "隆Muy bien! 隆Clasificaci贸n correcta! ";
            statusBox.classList.remove('bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800', 'border-yellow-400', 'border-red-400');
            statusBox.classList.add('bg-green-100', 'text-green-800', 'border-green-400');
            statusBox.classList.remove('hidden');

            targetZone.appendChild(droppedWord);
            droppedWord.classList.add('placed', 'm-1'); 
            droppedWord.setAttribute('draggable', false); 

            placedCount++;
            checkCompletion();
        }

        // Funci贸n auxiliar para la L贸gica de ERROR
        function errorLogic(droppedWord) {
            playErrorSound();
            statusBox.textContent = "隆Esa caja no es! Intenta en otra. ";
            statusBox.classList.remove('bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800', 'border-yellow-400', 'border-green-400');
            statusBox.classList.add('bg-red-100', 'text-red-800', 'border-red-400');
            statusBox.classList.remove('hidden');

            // Efecto visual de error (sacudir)
            droppedWord.style.transform = 'translateX(5px)';
            setTimeout(() => {
                droppedWord.style.transform = 'translateX(-5px)';
            }, 100);
            setTimeout(() => {
                droppedWord.style.transform = 'translateX(0)';
            }, 200);
        }

        // Funci贸n DROP (se usa solo con el mouse, el touch usa handleTouchEnd)
    function drop(ev) {
      ev.preventDefault();
      const dataId = ev.dataTransfer.getData("text/plain");
      const correctType = ev.dataTransfer.getData("type");
      const droppedWord = document.getElementById(dataId);
      const targetZone = ev.currentTarget;
     
      // Quitar el estilo de arrastre de la zona de destino
      targetZone.classList.remove('drag-over');

      if (!droppedWord || droppedWord.classList.contains('placed')) {
        return; // Si ya fue colocada o no hay palabra
      }

      // Comprobar si la ID de la zona de destino coincide con el tipo correcto
      if (targetZone.id === correctType) {
                dropLogic(droppedWord, targetZone);
      } else {
                errorLogic(droppedWord);
      }
    }
   
    // Funci贸n para verificar si el juego est谩 completo
    function checkCompletion() {
      if (placedCount === totalWords) {
        statusBox.textContent = "隆Felicidades! 隆Clasificaste todas las palabras! Eres un genio de los diptongos. コ";
        statusBox.classList.remove('bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
        statusBox.classList.add('bg-blue-100', 'text-blue-800', 'border-blue-400');
      }
    }

    // Funci贸n para reiniciar el juego
    function resetGame() {
      placedCount = 0;
      statusBox.classList.add('hidden');
     
      // Vaciar todas las drop zones
      const dropZones = document.querySelectorAll('.drop-zone');
      dropZones.forEach(zone => {
        const words = zone.querySelectorAll('.word-chip');
        words.forEach(word => {
          word.classList.remove('placed', 'm-1');
          word.setAttribute('draggable', true);
          word.style.transform = ''; // Remover cualquier transformaci贸n
          // NO es necesario reasignar dragstart si ya se hizo en generateWordChips
          wordPool.appendChild(word); // Devolver al pool
        });
      });

      // Si el wordPool estaba vac铆o (ej. en el primer inicio), generarlas
      if (wordPool.children.length === 0) {
        generateWordChips();
      } else {
        // Mezclar las palabras que regresaron al pool
        const existingChips = Array.from(wordPool.children);
        // Esto asegura que las palabras se vuelvan a mezclar visualmente en el pool, aunque no es un shuffle perfecto, es suficiente.
        existingChips.forEach(chip => wordPool.appendChild(chip));
      }
     
      statusBox.textContent = "隆Juego Reiniciado! Arrastra las palabras para empezar.";
      statusBox.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'bg-blue-100');
      statusBox.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-400');
    }


    // *** Inicializaci贸n ***
    window.onload = generateWordChips;

  </script>
</body>
</html>
